{"version":3,"file":"loader.min.js","sources":["../src/loader.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Video JS loader.\n *\n * This takes care of applying the filter on content which was dynamically loaded.\n *\n * @package    media_videojs\n * @copyright  2016 Frédéric Massart - FMCorz.net\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/event'], function($, Event) {\n\n    /**\n     * Stores the method we need to execute on the first load of videojs module.\n     */\n    var onload;\n\n    /**\n     * Set-up.\n     *\n     * Adds the listener for the event to then notify video.js.\n     * @param {Function} executeonload function to execute when media_videojs/video is loaded\n     */\n    var setUp = function(executeonload) {\n        onload = executeonload;\n        // Notify Video.js about the nodes already present on the page.\n        notifyVideoJS(null, $('body'));\n        // We need to call popover automatically if nodes are added to the page later.\n        Event.getLegacyEvents().done(function(events) {\n            $(document).on(events.FILTER_CONTENT_UPDATED, notifyVideoJS);\n        });\n    };\n\n    /**\n     * Notify video.js of new nodes.\n     *\n     * @param {Event} e The event.\n     * @param {NodeList} nodes List of new nodes.\n     */\n    var notifyVideoJS = function(e, nodes) {\n        var selector = '.mediaplugin_videojs';\n\n        // Find the descendants matching the expected parent of the audio and video\n        // tags. Then also addBack the nodes matching the same selector. Finally,\n        // we find the audio and video tags contained in those parents. Kind thanks\n        // to jQuery for the simplicity.\n        nodes.find(selector)\n            .addBack(selector)\n            .find('audio, video').each(function() {\n                var id = $(this).attr('id'),\n                    config = $(this).data('setup-lazy'),\n                    modules = ['media_videojs/video-lazy'];\n\n                if (config.techOrder && config.techOrder.indexOf('youtube') !== -1) {\n                    // Add YouTube to the list of modules we require.\n                    modules.push('media_videojs/Youtube-lazy');\n                }\n                if (config.techOrder && config.techOrder.indexOf('flash') !== -1) {\n                    // Add Flash to the list of modules we require.\n                    modules.push('media_videojs/videojs-flash-lazy');\n                }\n                require(modules, function(videojs) {\n                    if (onload) {\n                        onload(videojs);\n                        onload = null;\n                    }\n                    videojs(id, config);\n                });\n            });\n    };\n\n    return {\n        setUp: setUp\n    };\n\n});\n"],"names":["define","$","Event","onload","notifyVideoJS","e","nodes","find","addBack","each","id","this","attr","config","data","modules","techOrder","indexOf","push","require","videojs","setUp","executeonload","getLegacyEvents","done","events","document","on","FILTER_CONTENT_UPDATED"],"mappings":";;;;;;;;;AAwBAA,8BAAO,CAAC,SAAU,eAAe,SAASC,EAAGC,WAKrCC,OAwBAC,cAAgB,SAASC,EAAGC,OAO5BA,MAAMC,KANS,wBAOVC,QAPU,wBAQVD,KAAK,gBAAgBE,MAAK,eACnBC,GAAKT,EAAEU,MAAMC,KAAK,MAClBC,OAASZ,EAAEU,MAAMG,KAAK,cACtBC,QAAU,CAAC,4BAEXF,OAAOG,YAAsD,IAAzCH,OAAOG,UAAUC,QAAQ,YAE7CF,QAAQG,KAAK,8BAEbL,OAAOG,YAAoD,IAAvCH,OAAOG,UAAUC,QAAQ,UAE7CF,QAAQG,KAAK,oCAEjBC,QAAQJ,SAAS,SAASK,SAClBjB,SACAA,OAAOiB,SACPjB,OAAS,MAEbiB,QAAQV,GAAIG,qBAKrB,CACHQ,MAjDQ,SAASC,eACjBnB,OAASmB,cAETlB,cAAc,KAAMH,EAAE,SAEtBC,MAAMqB,kBAAkBC,MAAK,SAASC,QAClCxB,EAAEyB,UAAUC,GAAGF,OAAOG,uBAAwBxB"}